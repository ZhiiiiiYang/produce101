<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FFF9FA">
    <meta name="description" content="Produce 101: Busan & Fukuoka Travel App">
    <title>Our Travel 101</title>
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3063/3063822.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CSS Reset & Variables --- */
        :root {
            /* Sanrio Palette */
            --color-primary: #FFB7C5; /* My Melody Pink */
            --color-secondary: #A0D8EF; /* Cinnamoroll Blue */
            --color-accent: #FFD700; /* Pompompurin Yellow */
            --color-bg: #FFF9FA; /* Creamy White */
            --color-card: #FFFFFF;
            --color-text-main: #4A4A4A;
            --color-text-sub: #8E8E93;
            --color-border: #F0F0F0;
            
            /* Category Colors */
            --tag-sight: #FFB7C5;
            --tag-food: #FFD180;
            --tag-stay: #A0D8EF;
            --tag-transport: #B39DDB;

            /* UI Metrics */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 8px;
            --shadow-soft: 0 8px 24px rgba(149, 157, 165, 0.1);
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text-main);
            height: 100vh;
            height: 100dvh;
            overflow: hidden; /* Prevent body scroll, handle in app-container */
            display: flex;
            flex-direction: column;
        }

        /* --- Layout Structure --- */
        #app {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--nav-height) + var(--safe-bottom) + 20px);
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* Hide Scrollbar */
        #app::-webkit-scrollbar { display: none; }

        /* --- Typography --- */
        h1, h2, h3 { margin: 0; font-family: 'Playfair Display', serif; }
        .text-sm { font-size: 0.85rem; color: var(--color-text-sub); }
        .text-bold { font-weight: 700; }

        /* --- Components --- */
        .header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        .header h1 { font-size: 2rem; color: var(--color-text-main); }
        .header span { font-size: 0.9rem; color: var(--color-primary); font-weight: bold; letter-spacing: 1px; }

        /* Card Style */
        .card {
            background: var(--color-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-soft);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        .card:active { transform: scale(0.98); }

        /* Sanrio Deco - Ribbon */
        .card.ribbon::after {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 60px;
            height: 60px;
            background: var(--color-primary);
            transform: rotate(45deg);
            opacity: 0.2;
        }

        /* Timeline Styles */
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .day-badge {
            background: var(--color-primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .day-title { font-size: 1.1rem; font-weight: 600; flex: 1; margin-left: 10px; }
        .toggle-icon { color: var(--color-text-sub); transition: transform 0.3s; }
        
        .timeline-container {
            display: none; /* Hidden by default */
            margin-top: 15px;
            padding-left: 10px;
            border-left: 2px solid var(--color-border);
            margin-left: 10px;
        }
        .timeline-container.open { display: block; animation: fadeIn 0.3s ease; }

        .event-item {
            position: relative;
            padding-left: 20px;
            margin-bottom: 20px;
        }
        .event-item::before {
            content: '';
            position: absolute;
            left: -16px;
            top: 6px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--color-text-sub);
            border: 2px solid white;
            box-shadow: 0 0 0 2px var(--color-border);
        }
        /* Category dots */
        .event-item[data-cat="sight"]::before { background: var(--tag-sight); }
        .event-item[data-cat="food"]::before { background: var(--tag-food); }
        .event-item[data-cat="stay"]::before { background: var(--tag-stay); }
        .event-item[data-cat="transport"]::before { background: var(--tag-transport); }

        .event-time { font-size: 0.8rem; color: var(--color-text-sub); font-weight: 500; margin-bottom: 2px; }
        .event-name { font-size: 1rem; font-weight: 500; margin-bottom: 4px; display: flex; align-items: center;}
        .event-desc { font-size: 0.9rem; color: #666; line-height: 1.4; }
        
        .map-btn {
            margin-left: 8px;
            color: var(--color-secondary);
            font-size: 0.9rem;
            text-decoration: none;
        }

        /* --- Budget Page --- */
        .budget-header {
            background: linear-gradient(135deg, var(--color-primary), #FFD1DC);
            color: white;
            padding: 30px 20px;
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            text-align: center;
        }
        .total-amount { font-size: 2.5rem; font-weight: 700; font-family: 'Playfair Display', serif; }
        
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            outline: none;
            font-family: 'Noto Sans TC';
        }
        .btn-add {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: var(--radius-md);
            font-weight: bold;
            cursor: pointer;
        }
        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--color-border);
        }
        .btn-delete { color: #ff6b6b; margin-left: 10px; cursor: pointer; }

        /* --- Guide Page --- */
        .weather-widget {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to right, #A0D8EF, #E0F7FA);
            color: #333;
        }
        .guide-section h3 { margin-bottom: 15px; font-size: 1.2rem; border-left: 4px solid var(--color-primary); padding-left: 10px; }
        .checklist-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            background: white;
            padding: 12px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
        }
        .checklist-item i { margin-right: 12px; color: var(--color-primary); width: 20px; text-align: center;}

        /* --- Bottom Navigation --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: calc(var(--nav-height) + var(--safe-bottom));
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-around;
            padding-bottom: var(--safe-bottom);
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #C7C7CC;
            font-size: 0.75rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        .nav-item i { font-size: 1.4rem; margin-bottom: 4px; }
        .nav-item.active { color: var(--color-primary); }
        .nav-item.active i { transform: translateY(-2px); transition: transform 0.2s; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        
        /* Utility */
        .tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 5px; color: white; vertical-align: middle; }
        .bg-busan { background-color: var(--color-primary) !important; }
        .bg-fukuoka { background-color: var(--color-secondary) !important; }
        .bg-saga { background-color: #95E1D3 !important; }

    </style>
</head>
<body>

    <div id="app">
        </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('itinerary')">
            <i class="fa-solid fa-plane-departure"></i>
            <span>è¡Œç¨‹</span>
        </div>
        <div class="nav-item" onclick="switchTab('guide')">
            <i class="fa-solid fa-book-open-reader"></i>
            <span>æ”»ç•¥</span>
        </div>
        <div class="nav-item" onclick="switchTab('budget')">
            <i class="fa-solid fa-sack-dollar"></i>
            <span>è¨˜å¸³</span>
        </div>
    </nav>

    <script>
        // --- Data Definitions ---

        const itineraryData = [
            {
                day: 1, loc: "Busan", theme: "Produce 101: é‡œå±±ç¯‡", title: "æŠµé”èˆ‡å—æµ¦æ´é¢¨æƒ…", color: "bg-busan",
                events: [
                    { time: "ä¸‹åˆ", title: "æŠµé”é‡‘æµ·æ©Ÿå ´ (PUS)", desc: "å‰å¾€é£¯åº— (å»ºè­°ï¼šå—æµ¦æ´/è¥¿é¢)", cat: "transport", map: "Gimhae International Airport" },
                    { time: "å‚æ™š", title: "BIFF å»£å ´", desc: "å¿…åƒï¼šå …æœç³–é¤…", cat: "food", map: "BIFF Square Busan" },
                    { time: "æ™šä¸Š", title: "é‡œå±±å¡” / æ¨‚å¤©ç™¾è²¨è§€æ™¯", desc: "æ¬£è³å½±å³¶å¤§æ©‹èˆ‡æ¸¯å£å¤œæ™¯", cat: "sight", map: "Busan Tower" },
                    { time: "æ™šé¤", title: "æœ­å˜å…¶å¸‚å ´ / å¯Œå¹³å¤œå¸‚", desc: "æµ·é®®å¤§é¤æˆ–å¤œå¸‚å°åƒ", cat: "food", map: "Jagalchi Market" }
                ]
            },
            {
                day: 2, loc: "Busan", theme: "Produce 101: é‡œå±±ç¯‡", title: "æµ·é›²å°æµªæ¼«åˆ—è»Š", color: "bg-busan",
                events: [
                    { time: "ä¸Šåˆ", title: "æµ·é›²å°æ²™ç˜", desc: "æ‹äººç”Ÿå››æ ¼ã€æ•£æ­¥", cat: "sight", map: "Haeundae Beach" },
                    { time: "ä¸­åˆ", title: "æµ·ç†åœ˜é“", desc: "æ–‡é’é¤å»³åˆé¤", cat: "food", map: "Haeridan-gil" },
                    { time: "ä¸‹åˆ", title: "Blue Line Park", desc: "ğŸŒŸ å¿…å»ï¼šå¤©ç©ºè† å›Šåˆ—è»Š (éœ€é ç´„)", cat: "sight", map: "Blue Line Park Mipo Station" },
                    { time: "å‚æ™š", title: "é’æ²™æµ¦", desc: "ç´…ç™½ç‡ˆå¡”ã€æµ·æ™¯å’–å•¡ (H.us/Alice Donut)", cat: "food", map: "Cheongsapo" },
                    { time: "æ™šä¸Š", title: "The Bay 101", desc: "æ‘©å¤©æ¨“å€’å½±å¤œæ™¯", cat: "sight", map: "The Bay 101" }
                ]
            },
            {
                day: 3, loc: "Busan", theme: "Produce 101: é‡œå±±ç¯‡", title: "ç«¥è©±æ‘èˆ‡å»£å®‰é‡Œ", color: "bg-busan",
                events: [
                    { time: "10:00", title: "ç”˜å·æ´æ–‡åŒ–æ‘", desc: "å°ç‹å­åˆç…§ (æ—©é»å»é¿äººæ½®)", cat: "sight", map: "Gamcheon Culture Village" },
                    { time: "ä¸‹åˆ", title: "ç™½æ·ºç˜æ–‡åŒ–æ‘", desc: "çµ•ç¾æµ·å²¸æ­¥é“ã€çª—æ™¯å’–å•¡", cat: "sight", map: "Huinnyeoul Culture Village" },
                    { time: "æ™šä¸Š", title: "å»£å®‰é‡Œæµ·æ°´æµ´å ´", desc: "å»£å®‰å¤§æ©‹é»ç‡ˆ (é€±å…­æœ‰ç„¡äººæ©Ÿç§€)", cat: "sight", map: "Gwangalli Beach" },
                    { time: "æ™šé¤", title: "éŸ“å¼çƒ¤è‚‰", desc: "å»£å®‰é‡Œå‘¨é‚Šç¾é£Ÿ", cat: "food", map: "Gwangalli BBQ" }
                ]
            },
            {
                day: 4, loc: "Busan", theme: "Produce 101: é‡œå±±ç¯‡", title: "æ±—è’¸å¹• & ç§»å‹•æ—¥", color: "bg-busan",
                events: [
                    { time: "ä¸Šåˆ", title: "Spa Land", desc: "äº”æ˜Ÿç´šæ±—è’¸å¹• (Centum City)", cat: "sight", map: "Spa Land Centum City" },
                    { time: "ä¸‹åˆ", title: "æ–°ä¸–ç•Œç™¾è²¨", desc: "æœ€å¾Œè£œè²¨", cat: "sight", map: "Shinsegae Centum City" },
                    { time: "17:30", title: "é‡œå±±æ¸¯åœ‹éš›å®¢é‹ç¢¼é ­", desc: "æ–°å±±èŒ¶èŠ±è™Ÿå ±åˆ° (19:00ç™»èˆ¹)", cat: "transport", map: "Busan Port International Passenger Terminal" },
                    { time: "22:30", title: "èˆ¹ç­å‡ºç™¼", desc: "åœ¨èˆ¹ä¸Šäº«å—å¤§æµ´å ´èˆ‡ä¾¿åˆ©å•†åº—", cat: "transport", map: "" }
                ]
            },
            {
                day: 5, loc: "Fukuoka", theme: "Produce 101: ç¦å²¡ç¯‡", title: "æ—©å®‰ç¦å²¡ï¼å¸‚å€æ¼«éŠ", color: "bg-fukuoka",
                events: [
                    { time: "07:30", title: "æŠµé”åšå¤šæ¸¯", desc: "å…¥å¢ƒå¾Œå‰å¾€åšå¤šç«™å¯„æ”¾è¡Œæ", cat: "transport", map: "Hakata Port Tower" },
                    { time: "ä¸Šåˆ", title: "å¤§æ¿ å…¬åœ’", desc: "æ˜Ÿå·´å…‹æ—©é¤ã€ç¾è¡“é¤¨è‰é–“å½Œç”Ÿå—ç“œ", cat: "sight", map: "Ohori Park" },
                    { time: "ä¸‹åˆ", title: "å…­æœ¬æ¾ / LaLaport", desc: "è”¦å±‹æ›¸åº—æˆ–å·¨å‹é‹¼å½ˆ", cat: "sight", map: "LaLaport Fukuoka" },
                    { time: "æ™šä¸Š", title: "åšå¤šé‹æ²³åŸ", desc: "æ°´èˆç§€", cat: "sight", map: "Canal City Hakata" },
                    { time: "æ™šé¤", title: "åšå¤šç‰›è…¸é‹", desc: "å‰ç”°å±‹ æˆ– ã‚„ã¾ä¸­", cat: "food", map: "Motsunabe Maedaya" }
                ]
            },
            {
                day: 6, loc: "Yufuin", theme: "Produce 101: ç¦å²¡ç¯‡", title: "ç«¥è©±å°é®ç”±å¸ƒé™¢", color: "bg-fukuoka",
                events: [
                    { time: "äº¤é€š", title: "ç”±å¸ƒé™¢ä¹‹æ£®", desc: "ç‰¹æ€¥åˆ—è»Š (éœ€æå‰ä¸€å€‹æœˆé ç´„)", cat: "transport", map: "Hakata Station" },
                    { time: "ä¸‹åˆ", title: "æ¹¯ä¹‹åªè¡—é“", desc: "å²åŠªæ¯”èŒ¶å±‹ã€MiffyéºµåŒ…ã€å¯æ¨‚é¤…", cat: "food", map: "Yunotsubo Street" },
                    { time: "æ™¯é»", title: "ç”±å¸ƒé™¢èŠ±å‰æ‘", desc: "å‰åœåŠ›é¢¨æ ¼çŸ®æˆ¿ï¼Œè¶…å¥½æ‹", cat: "sight", map: "Yufuin Floral Village" },
                    { time: "ä½å®¿", title: "æº«æ³‰æ—…é¤¨", desc: "äº«å—ä¸€æ³ŠäºŒé£Ÿèˆ‡ç§äººæ¹¯å±‹", cat: "stay", map: "Yufuin Onsen" }
                ]
            },
            {
                day: 7, loc: "Fukuoka", theme: "Produce 101: ç¦å²¡ç¯‡", title: "æ™¨éœ§èˆ‡ä¸­æ´²å±‹å°", color: "bg-fukuoka",
                events: [
                    { time: "æ¸…æ™¨", title: "é‡‘é±—æ¹–", desc: "è§€è³å¤¢å¹»æ™¨éœ§", cat: "sight", map: "Kinrin Lake" },
                    { time: "ä¸­åˆ", title: "è¿”å›åšå¤š", desc: "æ­ä¹˜ JR", cat: "transport", map: "Hakata Station" },
                    { time: "ä¸‹åˆ", title: "å¤©ç¥åœ°ä¸‹è¡—", desc: "æµè¡Œæœé£¾ã€è—¥å¦è¡€æ‹¼", cat: "sight", map: "Tenjin Underground Shopping Center" },
                    { time: "æ™šä¸Š", title: "ä¸­æ´²å±‹å°è¡—", desc: "æ²³é‚Šå°æ”¤åƒæ‹‰éºµã€é—œæ±ç…®", cat: "food", map: "Nakasu Yatai" }
                ]
            },
            {
                day: 8, loc: "Itoshima", theme: "Produce 101: ç¦å²¡ç¯‡", title: "ç³¸å³¶æˆ€äººè–åœ°", color: "bg-fukuoka",
                events: [
                    { time: "äº¤é€š", title: "ç§Ÿè»Šè‡ªé§• / å…¬è»Š", desc: "å‰å¾€ç³¸å³¶", cat: "transport", map: "Itoshima" },
                    { time: "ä¸Šåˆ", title: "æ«»äº•äºŒè¦‹æµ¦", desc: "å¤«å©¦å²©èˆ‡ç™½è‰²é³¥å±…", cat: "sight", map: "Sakurai Futamigaura" },
                    { time: "åˆé¤", title: "æµ·é‚Šå’–å•¡å»³", desc: "Sunset CafÃ© æˆ– Current", cat: "food", map: "Futamigaura" },
                    { time: "ä¸‹åˆ", title: "æ£•æ«šæ¨¹é¦éŸ†", desc: "æ‹ç…§æ‰“å¡é»", cat: "sight", map: "Palm Tree Swing" },
                    { time: "æ™šé¤", title: "è±šéª¨æ‹‰éºµ", desc: "ShinShin æˆ– ä¸€è˜­ç¸½åº—", cat: "food", map: "Hakata Ramen ShinShin" }
                ]
            },
            {
                day: 9, loc: "Saga", theme: "Produce 101: ä½è³€ç¯‡", title: "å¤ªå®°åºœèˆ‡ç§»å‹•", color: "bg-saga",
                events: [
                    { time: "ä¸Šåˆ", title: "å¤ªå®°åºœå¤©æ»¿å®®", desc: "éšˆç ”å¾æ˜Ÿå·´å…‹ã€æ¢…æé¤…", cat: "sight", map: "Dazaifu Tenmangu" },
                    { time: "ä¸‹åˆ", title: "å‰å¾€ä½è³€", desc: "æ­ JR ç‰¹æ€¥ (ç´„40åˆ†)", cat: "transport", map: "Saga Station" },
                    { time: "ä½å®¿", title: "ä½è³€ç«™å‘¨é‚Š", desc: "Comfort Hotel æˆ– Route Inn", cat: "stay", map: "Saga Station Hotel" },
                    { time: "æ™šé¤", title: "ç•¶åœ°å±…é…’å±‹", desc: "é«”é©—åœ¨åœ°é¢¨æƒ…", cat: "food", map: "Saga Station Izakaya" }
                ]
            },
            {
                day: 10, loc: "Saga", theme: "Produce 101: ä½è³€ç¯‡", title: "ä½è³€ç¾å­¸ä¸€æ—¥éŠ", color: "bg-saga",
                events: [
                    { time: "ä¸Šåˆ", title: "æ­¦é›„å¸‚åœ–æ›¸é¤¨", desc: "æ—¥æœ¬æœ€ç¾åœ–æ›¸é¤¨ï¼Œçµ•ç¾æ›¸ç‰†", cat: "sight", map: "Takeo City Library" },
                    { time: "åˆé¤", title: "Kairoå ‚", desc: "ä½è³€ç‰›å£½å–œç‡’ä¾¿ç•¶ (ä¹å·å† è»)", cat: "food", map: "Takeo-Onsen Station" },
                    { time: "ä¸‹åˆ", title: "æ­¦é›„ç¥ç¤¾ & å¾¡èˆ¹å±±æ¨‚åœ’", desc: "3000å¹´å¤§æ¥ æ¨¹ã€teamLabå±•è¦½", cat: "sight", map: "Mifuneyama Rakuen" },
                    { time: "æ™šé¤", title: "ä½è³€ç‰›é¤å»³ å­£æ¨‚", desc: "å£“è»¸å¤§é¤ï¼Œå…¥å£å³åŒ–çš„ç¾å‘³", cat: "food", map: "Kira Saga" }
                ]
            },
            {
                day: 11, loc: "Home", theme: "Produce 101: è¿”å®¶", title: "ç”œèœœè¿”å®¶", color: "bg-saga",
                events: [
                    { time: "ä¸Šåˆ", title: "æ•´ç†è¡Œæ", desc: "æ‰“åŒ…æ»¿æ»¿æˆ°åˆ©å“", cat: "stay", map: "" },
                    { time: "äº¤é€š", title: "æ©Ÿå ´å·´å£«", desc: "ä½è³€å·´å£«ä¸­å¿ƒ -> ä½è³€æ©Ÿå ´", cat: "transport", map: "Saga Bus Center" },
                    { time: "æ©Ÿå ´", title: "æœ€å¾Œæ¡è²·", desc: "æµ·è‹”ã€å¬‰é‡èŒ¶ã€ä¹å·é¤…ä¹¾", cat: "sight", map: "Saga Airport" },
                    { time: "èµ·é£›", title: "é£›å¾€æº«æš–çš„å®¶", desc: "Travel End", cat: "transport", map: "" }
                ]
            }
        ];

        // --- Render Functions ---

        const app = document.getElementById('app');

        function renderItinerary() {
            let html = `
                <div class="header">
                    <div>
                        <span>OUR TRAVEL LOG</span>
                        <h1>Itinerary</h1>
                    </div>
                    <i class="fa-solid fa-map-location-dot" style="font-size: 2rem; color: var(--color-primary)"></i>
                </div>
            `;

            itineraryData.forEach((day, index) => {
                html += `
                <div class="card ${day.events.some(e => e.title.includes('å¿…')) ? 'ribbon' : ''}" onclick="toggleTimeline(${index})">
                    <div class="day-header">
                        <span class="day-badge ${day.color}">Day ${day.day}</span>
                        <span style="font-size: 0.8rem; color: #888; margin-left: 8px;">${day.loc}</span>
                        <div class="day-title">${day.title}</div>
                        <i id="icon-${index}" class="fa-solid fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="text-sm" style="margin-bottom: 5px; color: var(--color-primary);">${day.theme}</div>
                    
                    <div id="timeline-${index}" class="timeline-container">
                        ${day.events.map(event => `
                            <div class="event-item" data-cat="${event.cat}">
                                <div class="event-time">${event.time}</div>
                                <div class="event-name">
                                    ${event.title}
                                    ${event.map ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.title + " " + event.map)}" target="_blank" class="map-btn"><i class="fa-solid fa-diamond-turn-right"></i></a>` : ''}
                                </div>
                                <div class="event-desc">${event.desc}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                `;
            });

            // Add Footer padding
            html += '<div style="height: 50px;"></div>';
            return html;
        }

        function renderGuide() {
            return `
                <div class="header">
                     <div>
                        <span>TRAVEL TIPS</span>
                        <h1>Guide</h1>
                    </div>
                    <i class="fa-solid fa-sun" style="font-size: 2rem; color: var(--color-accent)"></i>
                </div>

                <div class="card weather-widget">
                    <div>
                        <div class="text-bold">Busan / Fukuoka</div>
                        <div class="text-sm">10Â°C - 18Â°C (é æ¸¬)</div>
                    </div>
                    <i class="fa-solid fa-cloud-sun" style="font-size: 2.5rem; color: white;"></i>
                </div>

                <div class="guide-section">
                    <h3><i class="fa-solid fa-check-double"></i> å‡ºç™¼å‰ Check List</h3>
                    <div class="checklist-item"><i class="fa-regular fa-square-check"></i> é ç´„ Sky Capsule (é‡œå±±)</div>
                    <div class="checklist-item"><i class="fa-regular fa-square-check"></i> é ç´„ ç”±å¸ƒé™¢ä¹‹æ£® (30å¤©å‰)</div>
                    <div class="checklist-item"><i class="fa-regular fa-square-check"></i> é ç´„ ä½è³€ç‰›å­£æ¨‚</div>
                    <div class="checklist-item"><i class="fa-regular fa-square-check"></i> Visit Japan Web QR Code</div>
                    
                    <h3><i class="fa-solid fa-gift"></i> å¿…è²·ä¼´æ‰‹ç¦®</h3>
                    <div class="card" style="background: #fff;">
                        <ul style="padding-left: 20px; margin: 0; line-height: 1.8;">
                            <li><strong>é‡œå±±ï¼š</strong> å …æœç³–é¤…èª¿ç†åŒ…ã€HBAF æä»æœã€Olive Young ç¾å¦ã€‚</li>
                            <li><strong>ç¦å²¡ï¼š</strong> åŠªåŠªé› (å†·ç‚¸é›)ã€æ˜å¤ªå­ä»™è²ã€åšå¤šé€šé¥…é ­ã€‚</li>
                            <li><strong>ä½è³€ï¼š</strong> ä½è³€æµ·è‹”ã€å¬‰é‡èŒ¶ã€å°åŸç¾Šç¾¹ã€‚</li>
                        </ul>
                    </div>

                    <h3><i class="fa-solid fa-circle-info"></i> å¯¦ç”¨è³‡è¨Š</h3>
                    <div class="card">
                        <p><strong>ç·Šæ€¥é›»è©± (æ—¥æœ¬)ï¼š</strong> 110 (è­¦) / 119 (ç«é†«)</p>
                        <p><strong>é›»å£“ï¼š</strong> éŸ“åœ‹ 220V (åœ“é ­), æ—¥æœ¬ 100V (æ‰é ­)</p>
                        <p><strong>å°è²»ï¼š</strong> å…©åœ‹çš†ç„¡å°è²»æ–‡åŒ–ã€‚</p>
                    </div>
                </div>
                 <div style="height: 50px;"></div>
            `;
        }

        function renderBudget() {
            const savedData = JSON.parse(localStorage.getItem('budgetData')) || [];
            const total = savedData.reduce((sum, item) => sum + parseInt(item.amount), 0);

            let listHtml = savedData.map((item, id) => `
                <div class="expense-item">
                    <div>
                        <div class="text-bold">${item.desc}</div>
                        <div class="text-sm">${item.date}</div>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <span class="text-bold">Â¥/â‚© ${item.amount}</span>
                        <i class="fa-solid fa-trash btn-delete" onclick="deleteBudget(${id})"></i>
                    </div>
                </div>
            `).join('');

            return `
                <div class="header">
                     <div>
                        <span>EXPENSES</span>
                        <h1>Budget</h1>
                    </div>
                </div>

                <div class="budget-header">
                    <div class="text-sm" style="color: rgba(255,255,255,0.8);">Total Spent</div>
                    <div class="total-amount">${total.toLocaleString()}</div>
                </div>

                <div class="card">
                    <div class="input-group">
                        <input type="text" id="b-desc" placeholder="é …ç›® (e.g. æ‹‰éºµ)">
                        <input type="number" id="b-amount" placeholder="é‡‘é¡" inputmode="numeric">
                    </div>
                    <button class="btn-add" style="width:100%; padding: 12px;" onclick="addBudget()">æ–°å¢æ”¯å‡º +</button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">æ¶ˆè²»ç´€éŒ„</h3>
                    ${savedData.length === 0 ? '<p class="text-sm" style="text-align:center;">ç›®å‰æ²’æœ‰è³‡æ–™</p>' : listHtml}
                </div>
                 <div style="height: 50px;"></div>
            `;
        }

        // --- Logic & Interactivity ---

        function switchTab(tabName) {
            // UI Update
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active'); // Note: this depends on event bubbling, simpler to re-select based on index logic but this works for onclick

            // Render Content
            window.scrollTo(0, 0);
            if (tabName === 'itinerary') app.innerHTML = renderItinerary();
            if (tabName === 'guide') app.innerHTML = renderGuide();
            if (tabName === 'budget') app.innerHTML = renderBudget();
            
            // Re-apply correct nav active state (fix for initial load logic separation)
            const navs = document.querySelectorAll('.nav-item');
            navs.forEach(n => n.classList.remove('active'));
            if(tabName === 'itinerary') navs[0].classList.add('active');
            if(tabName === 'guide') navs[1].classList.add('active');
            if(tabName === 'budget') navs[2].classList.add('active');
        }

        function toggleTimeline(index) {
            const container = document.getElementById(`timeline-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            
            if (container.classList.contains('open')) {
                container.classList.remove('open');
                icon.style.transform = 'rotate(0deg)';
            } else {
                container.classList.add('open');
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // Budget Logic
        function addBudget() {
            const desc = document.getElementById('b-desc').value;
            const amount = document.getElementById('b-amount').value;
            
            if (!desc || !amount) return alert("è«‹è¼¸å…¥é …ç›®èˆ‡é‡‘é¡");

            const newData = {
                desc: desc,
                amount: amount,
                date: new Date().toLocaleDateString()
            };

            const currentData = JSON.parse(localStorage.getItem('budgetData')) || [];
            currentData.unshift(newData); // Add to top
            localStorage.setItem('budgetData', JSON.stringify(currentData));
            
            app.innerHTML = renderBudget(); // Re-render
            // Keep tab active styling logic intact implicitly
            document.querySelectorAll('.nav-item')[2].classList.add('active');
        }

        function deleteBudget(index) {
            if(!confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™å—ï¼Ÿ")) return;
            
            const currentData = JSON.parse(localStorage.getItem('budgetData')) || [];
            currentData.splice(index, 1);
            localStorage.setItem('budgetData', JSON.stringify(currentData));
            
            app.innerHTML = renderBudget();
            document.querySelectorAll('.nav-item')[2].classList.add('active');
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            app.innerHTML = renderItinerary();
        });

    </script>
</body>
</html>
